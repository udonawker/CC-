# 関数
　関数は、与えられた実引数に対する処理の結果を返します。<br>

## 関数宣言と定義
　関数宣言は、関数の戻り値の型、関数名、仮引数リスト、オプションの例外仕様で構成されます。<br>
　また、関数宣言のことをプロトタイプ宣言とも呼びます。<br>

<pre>
戻り地の型 関数名(仮引数リスト);
</pre>

　たとえば、int型の仮引数xとnを受け取り、累乗を計算し、結果をint型で返す関数power()の宣言の例を以下に示します。<br>

<pre>
int power(int x, int n);
</pre>

　関数宣言を行うことで、その関数をプログラム中で使用できます。<br>
　なお、関数宣言と定義は同時に行えますが、複数のソースファイルからプログラムが構成され、その関数が複数のソースファイルから呼び出される場合、一般的にはヘッダファイルで関数宣言を行い、関数定義をソースファイルで行うスタイルが用いられます。<br>
　このpower()関数の定義の例を以下に示します。<br>

<pre>
int power(int x, int n) {
    int ret = 1;
    for (int i = 0; i < n; ++i) ret *= x;
    return ret;
}
</pre>

　また、以下のような形式の関数宣言も行えます。(C++11以降)。

<pre>
auto 関数名(仮引数リスト) -> 戻り値の型;
</pre>

　先のpower()関数をこの書式で書くと、以下のようになります。<br>

<pre>
auto power(int x, int n) -> int; // powerの関数宣言
auto power(int x, int n) -> int { // powerの関数定義
    int ret = 1;
    for (int i = 0; i < n; ++i) ret *= x;
    return ret;
}
</pre>

　関数は、呼び出される前にかならず宣言されていなければなりません。<br>
　なお、その関数が翻訳単位内で定義までに使用されていなければ、定義が宣言を兼ねます。<br>

## 戻り値の型
　関数は、1つのオブジェクトを戻り値として、呼び出し元へ返せます。<br>
　戻り値の型は、その呼び出し元へ返すオブジェクトの型です。戻り地の型は、CV修飾やポインタや参照を含みます。<br>
　戻り値のない関数も作成できます。関数が値を何も返さない場合は、それを指示するvoid型を使用します。<br>

<pre>
void 関数名(仮引数リスト);
</pre>

## 仮引数
　関数は、0個以上の仮引数を持ちます。<br>
　仮引数が0個、すなわち仮引数のない関数は、以下のように仮引数リストを省略するか、voidと記述します。C言語からも呼び出される関数(リンケージがextern "C"の関数)では、ヘッダファイル内でvoidを使用した宣言を用います(C言語は、仮引数リストを省略すると、関数の実引数の数および型が不明であると解釈します)。<br>

<pre>
戻り値の型 関数名();
戻り値の型 関数名(void);
</pre>

　複数の仮引数はカンマで区切られ、各仮引数は以下の書式で定義されます。<br>

<pre>
型 仮引数名 (= デフォルト実引数)
</pre>

　デフォルト実引数は、実引数が省略された場合に使用される値です。<br>
　power()関数の指数nのデフォルト値が2であれば、以下のように宣言されます。<br>

<pre>
int power(int x, int n = 2);
</pre>

　デフォルト値は、複数の仮引数に対して宣言できます。しかし、その後ろの仮引数がデフォルト実引数を持っていない仮引数は、デフォルト実引数を持てません。また、デフォルト実引数は後から追加できます。<br>

<pre>
void func1(int a, int b = 1); // OK bのデフォルト実引数は1
void func2(int a = 2, int b); // エラー! aより後ろの仮引数bが、
                              //         デフォルト実引数を持っていない
void func3(int a, int b = 3); // OK bのデフォルト実引数は3
void func3(int a = 4, int b); // OK aのデフォルト実引数は4、
                              //    bのデフォルト実引数は3
void func3(int a, int b = 5); // エラー! デフォルト実引数の変更はできない
</pre>

### COLUMN 可変長実引数について
関数の実引数は可変長にできます。std::printf()関数などが良い例でしょう。std::print()関数では、指定された書式に従い、実引数の数が変わります。<br>
関数宣言において、可変長実引数が適用される箇所は...で表され、必ず仮引数リストの最後に書かれます。<br>
可変長実引数については、cstdargに関するものを参照。<br>
C++11では、可変長テンプレートを使用することでも、河畔町実引数を実装できます。<br>

## 戻り値型の推論 @version_C++14
　関数は、戻り値の型にautoもしくはdecltype(auto)を記述することで、戻り値の型をreturn文から推論できます。<br>

<pre>
auto f() { return 1; }
decltype(auto) g() { return 1; }
</pre>

　この場合、f()とg()どちらの関数も、仮引数をとらず、intを返す関数であると推論されます。<br>
　decltype(auto)は、参照を返したい場合に使用します。<br>

<pre>
int value = 3;
int& ref = value;

auto f() { return ref; }
decltype(auto) g() { return ref; }
</pre>

　この場合、f()はintを返す関数になりますが、g()はint&を返す関数であると推論されます。decltype(auto)の関数で非参照の変数を返した場合は、参照ではなく値が返ります。<br>
　戻り値型を推論する関数は、宣言と定義を分けることもできます。その場合、その関数を使用するには定義が見えている必要があります。<br>
　そのほか、再起も許可されています。仮想化数に対して、この構文は使用できません<br>

## リンケージ指定
　実行可能プログラムは、1つ以上の翻訳単位を結合(リンク)して作られます。翻訳単位に含まれる変数や関数の名前は、その一意性を表すリンケージを持っています。<br>
　関数であれば、以下のようにリンケージが指定されます。<br>

<pre>
リンケージ指定 戻り値の型 関数名(仮引数リスト);

リンケージ指定 変数の型 変数名;
</pre>

　リンケージ指定には、以下の2種類があります。<br>

* **extern ["C", "C++"] → 外部リンケージを持つ**
* **static              → 内部リンケージを持つ**

　外部リンケージと内部リンケージの違いは、「その名前を別の翻訳単位から参照できるかどうか」になります。外部リンケージを持っていれば、ほかの翻訳単位から参照できますが、内部リンケージを持っていれば同じ翻訳単位からのみ参照可能であり、ほかの翻訳単位から参照できません。<br>
　リンケージ指定がない場合、その名前を別の翻訳単位から参照できません。<br>
　また、外部リンケージは、リンケージの言語を指定できます。"C"であればC言語のリンケージを、"C++"であればC++のリンケージを持ちます。<br>
　リンケージの言語が指定されないときは、C++のリンケージが使用されます。C言語、C++以外の言語のリンケージのサポートは実装依存です。<br>

## インライン指定
　inline指定子で関数をインライン関数に指定できます。インライン関数は、可能であれば呼び出した場所で関数がインライン展開されるため、関数呼び出しのオーバーヘッドがなくなります。ただし、実行コードサイズが大きくなってしまう問題も持ち合わせます。書式は以下のとおりです。<br>

<pre>
inline 戻り値の型 関数名(仮引数リスト);
</pre>

　inlineは省略できます。省略した場合は、非インライン関数とみなされますが、コンパイラの最適化によってインライン展開される可能性があります。<br>

## 関数の前方宣言
　関数を呼び出すためには、その関数の宣言が事前に行われている必要があります。ある関数の宣言が定義より先に行われていることを前方宣言と呼びます。<br>
　前方宣言の例を以下に示します。<br>

<pre>
void func1(int x); // 前方宣言

void func2(int x)
{
    func1(x); // 前方宣言が行われているので呼び出し可能
}
</pre>

## main関数
　main()関数は、グローバル名前空間に記述されるプログラムの最初に実行される関数です。int型の値を戻り値とし、0個もしくは2この仮引数を持つ以下のどちらかの形式で記述します。inlineやstatic、constexprとしては宣言できません。<br>

<pre>
int main();
int main(int argc, char* argv[]);
</pre>

　2つの仮引数を持つmain関数の各仮引数の意味は、以下のとおりです。<br>

* argc → コマンドライン引数の数
* argv → コマンドライン引数の文字列へのポインタを保持する配列<br>
 (argv配列の0番目には、プログラムを表す文字列が入り、それ以降にユーザー指定の引数が入ります)<br>

　return文を実行せずにmain()関数を終了した場合、return 0;でmain()関数を終了したものとみなされます。<br>

