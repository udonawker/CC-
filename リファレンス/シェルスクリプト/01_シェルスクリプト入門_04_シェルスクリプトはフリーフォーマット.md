# シェルスクリプトはフリーフォーマット
## 改行位置やインデントなどはかなり自由
### 解説
#### 記述の基本
　**シェルスクリプト**は、それ自体が**ソースファイル**であると同時に**実行ファイル**です。シェルは、シェルスクリプトの記述内容を逐次読み込みながらコマンド実行を進めます。しかし、実行ファイルであっても、その**改行位置**や**インデントの仕方**はかなり自由であり、さらにコメントを書き込むこともできるため、人間が読んでもわかりやすいsy留守クリプトを記述することができます。また、シェルスクリプト中の各コマンドはすべて**終了ステータス**を持っており、シェルスクリプトでは基本的にこの終了ステータスの真偽によって各種条件判定を行います。<br>
<br>
#### シェルスクリプトはフリーフォーマット
　前章のとおり、シェルスクリプトは、基本的にはコマンドラインに入力するコマンドの文字列をファイルに記述したものです。したがって、そｓの記述は1行単位の固定されたフォーマットであると思われるかもしれません。しかし、シェルスクリプトでは記述が見やすいように、任意に**スペース**、**タブ**、**改行**を入れることができます<sup>[※1](#note1)</sup>。とくに、コマンドの行頭にスペースやタブを入れるインデントを行うことにより、if文、for文などの構文の構造が把握しやすくなります。ただし、改行については、改行コードにリストを終端する意味があるため、任意の位置でまったく自由に改行してよいわけではなく、多少の制限があります。<sup>[※2](#note2)</sup>。これは、改行もスペースと同様に扱うC言語とは異なる点といえるでしょう。<br>

<small id="note1"> ※1 bashのコマンドラインに直接コマンド入力する場合、タブは補完用のキーに割り当てられているため、普通のタブを入力するには`Ctrl + V、Tab`とタイプする必要があります。</small><br>
<small id="note2"> ※2 「リストを終端する」とは、「そこまでの入力がコマンドとして実行されること」と、とりあえず考えておいて差し支えるありません。</small><br>

#### 行頭にスペースまたはタブを入れてもよい
　コマンドの入力時には、コマンド名の前に、好きなだけスペースやタブを入れることができます。**図A**は、シェルのプロンプト上に直接lsコマンドを入力している例ですが、このようにスペースやタブがあっても、シェルにとってはすべて同じlsコマンドとして解釈されます。<br>
<br>

#### 図A lsコマンドの実行例1
<pre>
$ ls                    普通にlsコマンドを入力
$   ls                  lsコマンドの前にスペース2つを追加
$     ls                lsコマンドの前にタブ1つを追加
</pre>
<br>

#### 行の継続で、コマンドの途中で改行してもよい
　さらにシェル文法上では、「\改行」のようにバックスラッシュ(\)の直後で開業すると、そこで1行につながり、バックスラッシュも改行もなかったものとして解釈されます。これを利用して、**図B**のように、lsコマンドのlとsの間で改行を行えます。奇妙ですが、これでもlsコマンドとして解釈されるのです。なお、\改行の直後の2行目では、まだコマンドが完結していないという意味で、シェルのプロンプトがプライマリの「$」からセカンダリの「> 」に変わります。<br>
<br>

#### 改行してもつながるパイプ
　lsコマンドの直後に改行すると、そこでlsコマンドが実行されてしまいますが、**図C**のようにlsの後に**パイプ**の|記号までを入力してから開業すると、シェルはまだパイプラインの途中であると解釈するため、セカンダリプロンプトを出して入力待ちになります。ここに、lessなどのコマンドを入力すると、無事パイプがつながり、結局1行で「ls | less」と入力したのと同じことになります。<br>
　この例での|記号の直後のように、リストの終端とみなされない位置で改行した場合、その改行はスペースなどと同じ単なる区切り文字とみなされるのです。<br>
　なお、パイプのほかにも、**&&リスト** や **||リスト**などでも、&&や||の直後で任意に改行することができます。<br>
<br>

#### いろいろなif文の書き方
　if文、while文などの各種構文は、その改行位置の違いによっていろいろな書き方ができます。ここでは、if文を例にとってそのいろいろな書き方を紹介しておきます。<br>
　**リストA** ～ **リストD** は、いろいろな書き方をしたif文です。もちろん、これらはすべて同じ意味になります。<br>
　**リストA**は標準的な書き方です。ifの右のtestコマンド([ ])の後ろで改行した後、thenの所でも改行し、if文の中のechoコマンドではインデントしています。**リストB**はやや短縮した書き方です。ifとthenを1行に書いていますが、thenの直前のtestコマンドのリストを終端する必要があるため、ここに;を入れています。**リストC**のような書き方はあまり行いませんが、thenの後にはもともと改行が必要ないことを利用し、thenの後にechoコマンドを1行で続けています。このechoの前には;をいれてはいけません。**リストD**はif文全体を1行に書いた例です。thenの前やfiの前では、その直前のリストを終端するために;が必要になります。短いif文の場合、1行に書いたほうが完結で良い場合があります。<br>
<br>

#### 図B lsコマンドの実行例2
<pre>
$ l\                lsコマンドのlの1文字だけで、「\改行」で改行
> s                 セカンダリプロンプトに続いてlsのsを入力
</pre>

#### 図C 改行してもつながるパイプ
<pre>
$ ls |              パイプの|の直後に改行
> less              セカンダリプロンプトに続いてlessを入力すればパイプがつながる
</pre>

#### リストA if文の記述例1
<pre>
if [ -f file ]              ifの→のtestコマンド ([ ]) の後ろで改行
then                        thenのところで改行
    echo 'fileが存在します'  if文の中のechoコマンドはインデントして記述
fi                          if文の終了
</pre>

#### リストB if文の記述例2
<pre>
if [ -f file ]; then        ;を使って、ifとthenの1行で記述
    echo 'fileが存在します'  if文の中のechoコマンドはインデントして記述
fi                          if文の終了
</pre>

#### リストC if文の記述例3
<pre>
if [ -f file ]              ifの右のtestコマンド ([ ]) の後ろで改行
then echo 'fileが存在します' thenの後ろにechoコマンドを続ける (;は不要)
fi                          if文の終了
</pre>

#### リストD if文の記述例4
<pre>
if [ ^f file ]; then echo ' fileが存在します'; fi    if文全体を1行で記述
</pre>

#### 改行の仕方のまとめ
　シェルスクリプトでの改行の仕方について、簡単にまとめると次のようになります。<br>

##### ●リストを終端するひつようがある場合は改行するか、代わりに;を使う
　if文のthenの前やwhile文のdoの前など、リストを終端する必要がある場合は基本的にはそこで改行します。1行に書きたい場所は改行の代わりに;を入れる必要があります。<br>
<br>

##### ●リストの終端でない位置には任意に改行を入れてよい
　if文のthenの直後やパイプの|の直後など、改行してもリストの終端とはみなされない位置では任意に改行を入れることができます。ただし、逆に1行に書く場合には;は不要で、;を入れるとエラーになります。<br>
<br>

##### ●本来改行を入れることができない位置でも、「\」で行の継続を行うことができる
　本来改行を入れることができない位置、たとえばコマンド引数などの途中でも、バックスラッシュ(￥)の直後に改行することによって、2行以上に分けて記述することができます。<br>
